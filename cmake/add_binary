macro(add_binary name)
  set(OBJ_FILES)
  foreach(file ${ARGN})
    add_custom_command(OUTPUT ${file}.o COMMAND nasm -f elf ${CMAKE_CURRENT_SOURCE_DIR}/${file}.asm -o ${file}.o)
    list(APPEND OBJ_FILES ${file}.o)
  endforeach()
  file(GLOB_RECURSE c_files "*.c")
  file(GLOB_RECURSE cpp_files "*.cpp")
  add_executable(${name} ${c_files} ${cpp_files} ${OBJ_FILES})
  set_target_properties(${name} PROPERTIES OUTPUT_NAME ${name}.bin)
endmacro(add_binary)
